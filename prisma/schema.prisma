// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model FinancialRecord {
  id        String   @id @default(cuid())
  date      DateTime
  income    Float
  expenses  Float
  balance   Float
  notes     String?
  incomeDetails Json?
  expenseDetails Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([date])
}

model FutureProject {
  id          String   @id @default(cuid())
  name        String
  description String?
  targetAmount Float
  currentAmount Float   @default(0)
  priority    Int      @default(0)
  isActive    Boolean  @default(true)
  images      String[] @default([])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([priority])
}

model Mission {
  id           String   @id @default(cuid())
  slug         String   @unique
  title        Json
  theme        Json
  summary      Json
  description  Json
  focusAreas   Json
  scripture    Json?
  nextSteps    Json
  pinned       Boolean  @default(false)
  heroImageUrl String?
  images       String[] @default([])
  startDate    DateTime?
  endDate      DateTime?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([pinned, updatedAt])
}

model ContactInfo {
  id           Int      @id @default(1)
  name         Json
  phone        String?
  email        String?
  address      Json
  social       Json
  mapEmbedUrl  String?
  coordinates  Json
  worshipTimes Json
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model NavigationItem {
  id        String   @id @default(cuid())
  label     Json
  href      String
  order     Int      @default(0)
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([order])
}

model PageContent {
  id         String   @id @default(cuid())
  page       String
  section    String
  title      Json?
  subtitle   Json?
  description Json?
  body       Json?
  metadata   Json?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([page, section])
}

model FinancialCategory {
  id            String   @id @default(cuid())
  code          String   @unique  // Unique identifier (e.g., "offering", "salary")
  name          String              // Display name (e.g., "ค่าถวาย", "เงินเดือน")
  type          String              // "income" or "expense"
  visible       Boolean  @default(true)
  aggregateInto String?             // Category to aggregate into (optional)
  order         Int      @default(0) // Display order
  year          Int?                // Year this category applies to (null = all years)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([type, order])
  @@index([year, type])
}

model CategorySettings {
  id        String   @id @default(cuid())
  year      Int                   // Settings are year-specific
  settings  Json                  // Stores visibility and aggregation settings
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([year])
}

model Bulletin {
  id              String   @id @default(cuid())
  title           Json                    // Multi-language title
  date            DateTime                // Sunday service date
  localPath       String                  // Local file path on Raspberry Pi
  cloudinaryUrl   String?                 // Backup URL on Cloudinary
  fileSize        Int?                    // File size in bytes
  isActive        Boolean  @default(true) // Published status
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([date(sort: Desc)])
  @@index([isActive, date(sort: Desc)])
}

model PathConfig {
  id        String   @id @default(cuid())
  path      String   @unique
  isEnabled Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ChurchLeader {
  id        String   @id @default(cuid())
  name      String
  position  String
  image     String?
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([order])
}

model Feedback {
  id        String   @id @default(cuid())
  name      String
  email     String?
  message   String
  status    String   @default("NEW") // "NEW", "READ", "ARCHIVED"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
}

model AdminSettings {
  id         String   @id @default(cuid())
  colorTheme String   @default("bw") // "bw" (black & white) or "lowkey" (low-key colors)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}
